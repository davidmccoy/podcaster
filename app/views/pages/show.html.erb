<div class="row">
  <div class="hero-container">
    <div class="spacer"></div>
  </div>
  <div class="hero-container page-info">
    <div class="hero-page-image">
      <div class="page-image no-border" style="background-image: url(<%= @logo_url %>)">
      </div>
    </div>
    <div class="hero-episode-container">
      <div class="page-name-container">
        <h1>
          <%= @page.name %>
        </h1>
        <% if current_user && policy(@page).edit? %>
          <div class="page-admin-button-container">
            <%= link_to 'Manage Podcast', page_dashboard_posts_path(@page), class: 'btn btn-sm btn-light' %>
            <% unless @page.externally_hosted %>
              <%= link_to '+ Episode', new_page_dashboard_post_path(@page), class: 'btn btn-sm btn-primary' %>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="page-description-container <%= 'shortened' if @shortened %>">
        <div class="page-description">
          <p>
            <%= @page.description %>
          </p>
        </div>
        <% if @shortened %>
          <div class="show-more-container">
            <button class="show-more btn btn-sm btn-light">
              Show more
            </button>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <div class="col-lg-8 offset-lg-2 col-md-12">
    <div class="posts-container">
      <p>
        Episodes
      </p>
      <% unless @page.posts.empty? %>
        <% @posts.each do |post| %>
          <hr>
          <div class="post-container">
            <div class="post-left">
              <%= link_to page_post_path(@page, post) do %>
                <% if current_user && policy(@page).edit? %>
                  <% if !post.postable.podcast_episode  && post.postable.import_errors %>
                    <% render 'shared/icons/exclamation_circle', color: 'red', size: '50px' %>
                  <% else %>
                    <div class="play-button-container">
                    </div>
                  <% end %>
                <% else %>
                  <div class="play-button-container">
                  </div>
                <% end %>
              <% end %>
            </div>
            <div class="post-right">
              <div class="post-info-container">
                <h4>
                  <%= link_to post.postable.title, page_post_path(@page, post) %>
                </h4>
                <p>
                  <%= 'Scheduled For: ' if post.publish_time > Time.now %>
                  <%= post.publish_time.localtime.strftime('%B %-m, %Y') %>
                </p>
                <p>
                  <%= simple_format(truncate(post.postable.content.to_plain_text, length: 150)) %>
                </p>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <div class="no-episodes">
          <% if current_user && policy(@page).edit? %>
            <p>
              You don't have any podcast episodes. <%= link_to 'Add one now!', new_page_dashboard_post_path(@page) %>
            </p>
          <% else %>
            <p>
              <%= @page.name %> hasn't posted any episodes yet.
            </p>
          <% end %>
        </div>
      <% end %>
    </div>
    <div class="pagination-container">
      <%= will_paginate @posts %>
    </div>
  </div>
</div>

<script>
  $(document).on('ready turbolinks:load', function() {
    $('.show-more').on('click', function() {
      $('.page-description-container').removeClass('shortened');
      $('.page-description').height('auto');
      $('.show-more-container').hide();
    })
  })
</script>
